
$(document).ready(function() {
    // Initialize the order functionality
    PizzaShop.Order.init();
    
    // Category filtering (from your existing code)
    $('.list-group-item-action').click(function(e) {
        e.preventDefault();
        $('.list-group-item-action').removeClass('active');
        $(this).addClass('active');
        
        const category = $(this).data('category');
        filterItems(category);
    });

    $('.btn-link').click(function() {
        const itemId = $(this).data('item-id');
        toggleFavorite(itemId, $(this));
    });
    
    // Search functionality (from your existing code)
    $('input[type="text"]').on('keyup', function() {
        const searchValue = $(this).val().toLowerCase();
        $('.menu-item').each(function() {
            const itemName = $(this).find('.card-title').text().toLowerCase();
            if (itemName.includes(searchValue)) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
});

// Create a namespace for the Order functionality
var PizzaShop = PizzaShop || {};
PizzaShop.Order = (function() {
    // Private variables
    var currentOrder = {
        orderId: 0,
        items: [],
        taxes: [],
        subTotal: 0,
        totalAmount: 0
    };
    
    // Cache DOM elements
    var $orderItemsContainer;
    var $subTotal;
    var $totalAmount;
    var $paymentMethodRadios;
    
    // Initialize the module
    function init() {
        $orderItemsContainer = $('.order-items');
        $subTotal = $('#subTotal');
        $totalAmount = $('#totalAmount');
        $paymentMethodRadios = $('input[name="paymentMethod"]');
        
        // Bind events
        bindEvents();
        
        // If URL contains orderId parameter, load that order
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');
        if (orderId) {
            loadOrderDetails(orderId);
        }
        
        // Setup accordion functionality for order items
        setupAccordion();
    }
    
    // Bind all events
    function bindEvents() {
        // Quantity control buttons
        $(document).on('click', '.quantity-control button', function() {
            const $input = $(this).closest('.quantity-control').find('input');
            const currentVal = parseInt($input.val());
            
            if ($(this).text() === '+') {
                $input.val(currentVal + 1);
            } else if ($(this).text() === '-' && currentVal > 1) {
                $input.val(currentVal - 1);
            }
            
            // Get the item details and update quantities
            const $item = $(this).closest('.accordion-item');
            const itemIndex = $item.data('item-index');
            
            if (itemIndex !== undefined) {
                updateItemQuantity(itemIndex, parseInt($input.val()));
            }
        });
        
        // Delete item buttons
        $(document).on('click', '.btn-trash', function() {
            const $item = $(this).closest('.accordion-item');
            const itemIndex = $item.data('item-index');
            
            if (itemIndex !== undefined) {
                removeItem(itemIndex);
                $item.remove();
                recalculateTotals();
            }
        });
        
        // Payment method change
        $paymentMethodRadios.on('change', function() {
            currentOrder.paymentMode = $(this).attr('id').replace('Payment', '');
        });
        
        // Save button
        $('.btn-primary').on('click', function() {
            saveOrder();
        });
        
        // Complete button
        $('.btn-outline-primary').on('click', function() {
            completeOrder();
        });
        
        // Generate Invoice button
        $('.btn-outline-secondary').on('click', function() {
            generateInvoice();
        });
        
        // Cancel button
        $('.btn-outline-danger').on('click', function() {
            cancelOrder();
        });
    }
    
    // Setup accordion functionality
    function setupAccordion() {
        $(document).on('click', '.accordion-header', function() {
            const $item = $(this).closest('.accordion-item');
            const $body = $item.find('.accordion-body');
            
            $body.slideToggle(200);
            $(this).find('i').toggleClass('fa-chevron-down fa-chevron-right');
        });
    }
    
    // Load order details from the server
    function loadOrderDetails(orderId) {
        $.ajax({
            url: '/Order/GetOrderDetails',
            type: 'GET',
            data: { orderId: 1 },
            dataType: 'json',
            success: function(response) {
                if (response) {
                    populateOrderDetails(response);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading order details:', error);
                alert('Failed to load order details. Please try again.');
            }
        });
    }
    
    // Populate the order summary with order details
    function populateOrderDetails(orderDetails) {
        // Store the current order
        currentOrder = {
            orderId: orderDetails.orderId,
            items: orderDetails.orderItems || [],
            taxes: orderDetails.taxes || [],
            subTotal: orderDetails.subTotal,
            totalAmount: orderDetails.totalAmount,
            paymentMode: orderDetails.paymentMode,
            status: orderDetails.status
        };
        
        // Clear existing items
        $orderItemsContainer.empty();
        
        // Populate table info
        $('.table-info .fw-bold').text(orderDetails.sectionName || 'First Floor');
        $('.table-info .text-muted').text('Table: ' + (orderDetails.tableName || 'T2, T6'));
        
        // Add order items
        if (orderDetails.orderItems && orderDetails.orderItems.length > 0) {
            orderDetails.orderItems.forEach(function(item, index) {
                appendOrderItem(item, index);
            });
        }
        
        // Populate totals
        populateTotals(orderDetails);
        
        // Set payment method
        if (orderDetails.paymentMode) {
            const paymentMode = orderDetails.paymentMode.toLowerCase();
            $(`#${paymentMode}Payment`).prop('checked', true);
        }
    }
    
    // Append an order item to the container
    function appendOrderItem(item, index) {
        const modifiersHtml = item.modifiers && item.modifiers.length > 0 
            ? item.modifiers.map(mod => `
                <div class="d-flex justify-content-between text-muted small mb-1">
                    <span>• ${mod.modifierName}</span>
                    <span>₹${mod.price.toFixed(2)}</span>
                </div>
            `).join('') 
            : '';
            
        const modifiersTotalAmount = item.modifiers && item.modifiers.length > 0
            ? item.modifiers.reduce((total, mod) => total + mod.totalAmount, 0)
            : 0;
            
        const itemHtml = `
        <div class="accordion-item mb-2" data-item-index="${index}">
            <div class="d-flex align-items-center border-bottom pb-2">
                <div class="col-6">
                    <div class="accordion-header d-flex align-items-center">
                        <i class="fas fa-chevron-down me-2"></i>
                        <span class="fw-bold">${item.itemName}</span>
                    </div>
                </div>
                <div class="col-3">
                    <div class="input-group input-group-sm quantity-control">
                        <button class="btn btn-outline-secondary" type="button">-</button>
                        <input type="text" class="form-control text-center" value="${item.quantity}">
                        <button class="btn btn-outline-secondary" type="button">+</button>
                    </div>
                </div>
                <div class="col-2 text-end fw-bold">₹${item.price.toFixed(2)}</div>
                <div class="col-1 text-end">
                    <button class="btn btn-sm text-danger p-0 btn-trash"><i class="fas fa-trash"></i></button>
                </div>
            </div>
            ${item.modifiers && item.modifiers.length > 0 ? `
            <div class="accordion-body pt-2 pb-1">
                <div class="ms-3">
                    ${modifiersHtml}
                </div>
                <div class="text-end text-muted small">₹${modifiersTotalAmount.toFixed(2)}</div>
            </div>
            ` : ''}
        </div>
        `;
        
        $orderItemsContainer.append(itemHtml);
    }
    
    // Populate order totals section
    function populateTotals(orderDetails) {
        // Clear existing tax items
        $('.order-totals').empty();
        
        // Add subtotal
        $('.order-totals').append(`
            <div class="d-flex justify-content-between mb-1">
                <span>SubTotal</span>
                <span>₹${orderDetails.subTotal.toFixed(2)}</span>
            </div>
        `);
        
        // Add taxes
        if (orderDetails.taxes && orderDetails.taxes.length > 0) {
            orderDetails.taxes.forEach(function(tax) {
                $('.order-totals').append(`
                    <div class="d-flex justify-content-between mb-1">
                        <span>${tax.taxName}</span>
                        <span>₹${tax.taxValue.toFixed(2)}</span>
                    </div>
                `);
            });
        }
        
        // Update total amount
        $('#totalAmount').text(`₹${orderDetails.totalAmount.toFixed(2)}`);
    }
    
    // Update item quantity
    function updateItemQuantity(itemIndex, newQuantity) {
        if (currentOrder.items[itemIndex]) {
            const item = currentOrder.items[itemIndex];
            const oldQuantity = item.quantity;
            item.quantity = newQuantity;
            
            // Update total amount for this item
            const pricePerUnit = item.price / oldQuantity;
            item.price = pricePerUnit * newQuantity;
            
            // Update modifiers if any
            if (item.modifiers && item.modifiers.length > 0) {
                item.modifiers.forEach(function(mod) {
                    const modPricePerUnit = mod.price / oldQuantity;
                    mod.quantity = newQuantity;
                    mod.price = modPricePerUnit * newQuantity;
                    mod.totalAmount = mod.price;
                });
            }
            
            // Update item total
            item.totalAmount = item.price + (item.modifiers ? item.modifiers.reduce((total, mod) => total + mod.totalAmount, 0) : 0);
            
            // Recalculate totals
            recalculateTotals();
        }
    }
    
    // Remove an item from the order
    function removeItem(itemIndex) {
        if (currentOrder.items[itemIndex]) {
            currentOrder.items.splice(itemIndex, 1);
        }
    }
    
    // Recalculate order totals
    function recalculateTotals() {
        // Calculate subtotal
        currentOrder.subTotal = currentOrder.items.reduce((total, item) => total + item.totalAmount, 0);
        
        // Calculate taxes
        if (currentOrder.taxes && currentOrder.taxes.length > 0) {
            // Example tax calculation - this should match your business logic
            currentOrder.taxes.forEach(function(tax) {
                // Simple percentage calculation
                if (tax.taxName === 'CGST') {
                    tax.taxValue = currentOrder.subTotal * 0.12; // 12% CGST
                } else if (tax.taxName === 'GST') {
                    tax.taxValue = currentOrder.subTotal * 0.02; // 2% GST
                } else if (tax.taxName === 'SGST') {
                    tax.taxValue = currentOrder.subTotal * 0.12; // 12% SGST
                } else if (tax.taxName === 'Other') {
                    tax.taxValue = 89.00; // Fixed amount
                }
            });
        }
        
        // Calculate total amount
        const taxTotal = currentOrder.taxes.reduce((total, tax) => total + tax.taxValue, 0);
        currentOrder.totalAmount = currentOrder.subTotal + taxTotal;
        
        // Update the UI
        updateTotalsUI();
    }
    
    // Update totals in the UI
    function updateTotalsUI() {
        // Update subtotal
        $('.order-totals div:first-child span:last-child').text(`₹${currentOrder.subTotal.toFixed(2)}`);
        
        // Update taxes
        if (currentOrder.taxes && currentOrder.taxes.length > 0) {
            currentOrder.taxes.forEach(function(tax, index) {
                $(`.order-totals div:nth-child(${index + 2}) span:last-child`).text(`₹${tax.taxValue.toFixed(2)}`);
            });
        }
        
        // Update total amount
        $('#totalAmount').text(`₹${currentOrder.totalAmount.toFixed(2)}`);
    }
    
    // Save the current order
    function saveOrder() {
        if (currentOrder.items.length === 0) {
            alert('Please add items to the order before saving.');
            return;
        }
        
        const orderData = {
            orderId: currentOrder.orderId,
            paymentMode: currentOrder.paymentMode || $('input[name="paymentMethod"]:checked').attr('id').replace('Payment', ''),
            tableName: $('.table-info .text-muted').text().replace('Table: ', ''),
            sectionName: $('.table-info .fw-bold').text(),
            orderItems: currentOrder.items,
            taxes: currentOrder.taxes,
            subTotal: currentOrder.subTotal,
            totalAmount: currentOrder.totalAmount
        };
        
        $.ajax({
            url: '/Order/SaveOrder',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(orderData),
            success: function(response) {
                if (response && response.success) {
                    alert('Order saved successfully!');
                    if (response.orderId) {
                        currentOrder.orderId = response.orderId;
                    }
                } else {
                    alert('Failed to save order. Please try again.');
                }
            },
            error: function(xhr, status, error) {
                console.error('Error saving order:', error);
                alert('Failed to save order. Please try again.');
            }
        });
    }
    
    // Complete the current order
    function completeOrder() {
        if (currentOrder.orderId === 0) {
            alert('Please save the order before completing it.');
            return;
        }
        
        $.ajax({
            url: '/Order/CompleteOrder',
            type: 'POST',
            data: { orderId: currentOrder.orderId },
            success: function(response) {
                if (response && response.success) {
                    alert('Order completed successfully!');
                    currentOrder.status = 'Completed';
                } else {
                    alert('Failed to complete order. Please try again.');
                }
            },
            error: function(xhr, status, error) {
                console.error('Error completing order:', error);
                alert('Failed to complete order. Please try again.');
            }
        });
    }
    
    // Generate invoice for the current order
    function generateInvoice() {
        if (currentOrder.orderId === 0) {
            alert('Please save the order before generating an invoice.');
            return;
        }
        
        // Open invoice in a new window
        window.open(`/Order/GetPdf?id=${currentOrder.orderId}`, '_blank');
    }
    
    // Cancel the current order
    function cancelOrder() {
        if (currentOrder.orderId === 0) {
            // Just clear the UI if the order hasn't been saved
            clearOrderUI();
            return;
        }
        
        if (confirm('Are you sure you want to cancel this order?')) {
            $.ajax({
                url: '/Order/CancelOrder',
                type: 'POST',
                data: { orderId: currentOrder.orderId },
                success: function(response) {
                    if (response && response.success) {
                        alert('Order cancelled successfully!');
                        clearOrderUI();
                    } else {
                        alert('Failed to cancel order. Please try again.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error cancelling order:', error);
                    alert('Failed to cancel order. Please try again.');
                }
            });
        }
    }
    
    // Clear the order UI
    function clearOrderUI() {
        $orderItemsContainer.empty();
        $('.order-totals').empty();
        $('.order-totals').append(`
            <div class="d-flex justify-content-between mb-1">
                <span>SubTotal</span>
                <span>₹0.00</span>
            </div>
        `);
        $('#totalAmount').text('₹0.00');
        currentOrder = {
            orderId: 0,
            items: [],
            taxes: [],
            subTotal: 0,
            totalAmount: 0
        };
    }
    
    // Add a new item to the order
    function addItemToOrder(item) {
        // Create new item object
        const newItem = {
            itemName: item.itemName,
            quantity: 1,
            price: item.rate,
            totalAmount: item.rate,
            modifiers: []
        };
        
        // Add item to current order
        currentOrder.items.push(newItem);
        
        // Add item to UI
        appendOrderItem(newItem, currentOrder.items.length - 1);
        
        // Recalculate totals
        recalculateTotals();
    }
    
    // Public API
    return {
        init: init,
        addItemToOrder: addItemToOrder,
        loadOrderDetails: loadOrderDetails
    };
})();

// From your existing code
function filterItems(category) {
    $('.menu-item').each(function() {
        const itemCategory = $(this).data('category');
        const isFavorite = $(this).data('favorite') == 'true';
        
        const showItem = 
            category === 'all' ||
            (category === 'favorites' && isFavorite) ||
            itemCategory == category;
        
        $(this).toggle(showItem);
    });
}

async function toggleFavorite(itemId, element) {
    try {
        const response = await fetch(`/Menu/ToggleFavorite/${itemId}`, {
            method: 'POST'
        });
        if (response.ok) {
            element.toggleClass('text-muted text-primary');
            const icon = element.find('i');
            icon.toggleClass('far fas');

            const menuItem = element.closest('.menu-item');
            const currentFavorite = menuItem.data('favorite');
            menuItem.data('favorite', !currentFavorite);
        }
    } catch (error) {
        console.error('Error toggling favorite:', error);
    }
}

// Add click handler for menu items
$(document).on('click', '.menu-card', function() {
    const $menuItem = $(this).closest('.menu-item');
    const itemName = $menuItem.find('.card-title').text();
    const itemPrice = parseFloat($menuItem.find('.card-text').text().replace('₹', ''));
    
    // Create a simple item object
    const item = {
        itemName: itemName,
        rate: itemPrice
    };
    
    // Add to order
    PizzaShop.Order.addItemToOrder(item);
});@model PizzaShop.Entity.ViewModel.OrderMenuViewModel
@{
    Layout = "~/Views/Shared/_OrderAppLayout.cshtml";
    ViewData["Title"] = "Order Menu";
}

<div class="container-fluid">
    <div class="row">
        <!-- Category Sidebar -->
        <div class="col-md-2 col-lg-2 col-xl-2 p-0 bg-white category-sidebar">
            <div class="p-3">
                <h5 class="mb-3">Category</h5>
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action" data-category="favorites">Favorite
                        Items</a>
                    <a href="#" class="list-group-item list-group-item-action active" data-category="all">All</a>
                    @foreach (var category in Model.Categories)
                    {
                        <a href="#" class="list-group-item list-group-item-action"
                            data-category="@category.CategoryId">@category.CategoryName</a>
                    }
                </div>
            </div>
        </div>

        <!-- Menu Items Section -->
        <div class="col-md-6 col-lg-6 col-xl-6 bg-light">
            <div class="p-3">
                <!-- Search Bar and Legend -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search" aria-label="Search">
                            <span class="input-group-text bg-white border-start-0">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="d-inline-block me-3">
                            <span class="badge rounded-circle p-1 bg-success me-1"></span>
                            Vegetarian
                        </div>
                        <div class="d-inline-block me-3">
                            <span class="badge rounded-circle p-1 bg-danger me-1"></span>
                            Non-Vegetarian
                        </div>
                        <div class="d-inline-block">
                            <span class="badge rounded-circle p-1 vegan-badge me-1"></span>
                            Vegan
                        </div>
                    </div>
                </div>

                <!-- Menu Grid -->
                <div class="row g-3" id="menu-items-container">
                    @foreach (var item in Model.MenuItems)
                    {
                        <div class="col-6 col-sm-6 col-md-4 col-lg-4 col-xl-3 menu-item" data-category="@item.CategoryId"
                            data-favorite="@item.IsFavourite.ToString().ToLower()" data-type="@item.ItemType.ToLower()">
                            <div class="card h-100 position-relative menu-card">
                                <div class="type-indicator @item.ItemType.ToLower()"></div>
                                <div class="card-body d-flex align-items-center">
                                    <div class="item-image-container me-2">
                                        <img src="@item.ItemImage" alt="@item.ItemName" class="item-image">
                                    </div>
                                    <div>
                                        <h6 class="card-title mb-1">@item.ItemName</h6>
                                        <p class="card-text mb-0">₹@item.Rate</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button
                                            class="btn btn-link p-0 @(item.IsFavourite == true ? "text-primary" : "text-muted")"
                                            data-item-id="@item.ItemId">
                                            <i class="@(item.IsFavourite == true ? "fas" : "far") fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <!-- Order Summary Section -->
        <div class="col-md-4 col-lg-4 col-xl-4">
            <div class="bg-white p-3 h-100 order-summary">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="table-info d-flex align-items-center">
                        <i class="fa-solid fa-chair me-2"></i>
                        <div>
                            <div class="fw-bold">First Floor</div>
                            <div class="text-muted small">Table: T2, T6</div>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-1"><i class="fas fa-qrcode"></i></button>
                        <button class="btn btn-sm btn-outline-secondary me-1"><i class="fas fa-user"></i></button>
                        <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-comment"></i></button>
                    </div>
                </div>

                <!-- Items List -->
                <div class="order-items mb-3">
                    <!-- Margherita -->
                    <div class="accordion-item mb-2">
                        <div class="d-flex align-items-center border-bottom pb-2">
                            <div class="col-6">
                                <div class="accordion-header d-flex align-items-center">
                                    <i class="fas fa-chevron-down me-2"></i>
                                    <span class="fw-bold">Margherita</span>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="input-group input-group-sm quantity-control">
                                    <button class="btn btn-outline-secondary" type="button">-</button>
                                    <input type="text" class="form-control text-center" value="1">
                                    <button class="btn btn-outline-secondary" type="button">+</button>
                                </div>
                            </div>
                            <div class="col-2 text-end fw-bold">₹120.00</div>
                            <div class="col-1 text-end">
                                <button class="btn btn-sm text-danger p-0"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="accordion-body pt-2 pb-1">
                            <div class="ms-3">
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>• Onion</span>
                                    <span>₹20.00</span>
                                </div>
                            </div>
                            <div class="text-end text-muted small">₹20.00</div>
                        </div>
                    </div>

                    <!-- Aaloo Sandwich -->
                    <div class="accordion-item mb-2">
                        <div class="d-flex align-items-center border-bottom pb-2">
                            <div class="col-6">
                                <div class="accordion-header d-flex align-items-center">
                                    <i class="fas fa-chevron-down me-2"></i>
                                    <span class="fw-bold">Aaloo Sandwich</span>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="input-group input-group-sm quantity-control">
                                    <button class="btn btn-outline-secondary" type="button">-</button>
                                    <input type="text" class="form-control text-center" value="1">
                                    <button class="btn btn-outline-secondary" type="button">+</button>
                                </div>
                            </div>
                            <div class="col-2 text-end fw-bold">₹120.00</div>
                            <div class="col-1 text-end">
                                <button class="btn btn-sm text-danger p-0"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="accordion-body pt-2 pb-1">
                            <div class="ms-3">
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>• Mushroom</span>
                                    <span>₹50.00</span>
                                </div>
                            </div>
                            <div class="text-end text-muted small">₹50.00</div>
                        </div>
                    </div>

                    <!-- Capsicum -->
                    <div class="accordion-item mb-2">
                        <div class="d-flex align-items-center border-bottom pb-2">
                            <div class="col-6">
                                <div class="accordion-header d-flex align-items-center">
                                    <i class="fas fa-chevron-down me-2"></i>
                                    <span class="fw-bold">Capsicum</span>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="input-group input-group-sm quantity-control">
                                    <button class="btn btn-outline-secondary" type="button">-</button>
                                    <input type="text" class="form-control text-center" value="1">
                                    <button class="btn btn-outline-secondary" type="button">+</button>
                                </div>
                            </div>
                            <div class="col-2 text-end fw-bold">₹800</div>
                            <div class="col-1 text-end">
                                <button class="btn btn-sm text-danger p-0"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="accordion-body pt-2 pb-1">
                            <div class="ms-3">
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>• Onion</span>
                                    <span>₹20</span>
                                </div>
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>• Pepperoni</span>
                                    <span>₹500</span>
                                </div>
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>• Medium</span>
                                    <span>₹150</span>
                                </div>
                            </div>
                            <div class="text-end text-muted small">₹670.00</div>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="order-totals py-2 border-top">
                    <div class="d-flex justify-content-between mb-1">
                        <span>SubTotal</span>
                        <span>₹1780.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>CGST</span>
                        <span>₹213.60</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>GST</span>
                        <span>₹35.60</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Other</span>
                        <span>₹89.00</span>
                    </div>
                </div>

                <div class="d-flex justify-content-between fw-bold mb-3">
                    <div>Total</div>
                    <div>₹2118.20</div>
                </div>

                <!-- Payment Method -->
                <div class="d-flex justify-content-between mb-3">
                    <label class="mb-2">Payment Method</label>
                    <div class="">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="cashPayment" checked>
                            <label class="form-check-label" for="cashPayment">Cash</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="cardPayment">
                            <label class="form-check-label" for="cardPayment">Card</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="upiPayment">
                            <label class="form-check-label" for="upiPayment">UPI</label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <div class="row g-2">
                        <div class="col-4">
                            <button class="btn btn-primary w-100">Save</button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-primary w-100">Complete</button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100">Generate Invoice</button>
                        </div>
                        <div class="col-12 mt-2">
                            <button class="btn btn-outline-danger w-100">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    /* Order Summary Styles */
    .order-summary {
        border-left: 1px solid #e0e0e0;
        height: calc(100vh - 60px);
        overflow-y: auto;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .accordion-item {
        background-color: #fff;
        border-radius: 4px;
    }

    .accordion-header {
        cursor: pointer;
    }

    .accordion-body {
        background-color: #f9f9f9;
        border-radius: 0 0 4px 4px;
    }

    .quantity-control {
        width: 85px;
    }

    .quantity-control .form-control {
        text-align: center;
        padding: 0.25rem;
    }

    .input-group-sm .btn {
        padding: 0.25rem 0.4rem;
        font-size: 0.875rem;
    }

    /* Ensure proper spacing between elements */
    .order-items .accordion-item:last-child {
        margin-bottom: 0;
    }

    /* Category Sidebar Styles */
    .category-sidebar {
        min-height: calc(100vh - 60px);
        border-right: 1px solid #e0e0e0;
    }

    .list-group-item {
        border-left: none;
        border-right: none;
        border-radius: 0 !important;
        padding: 0.5rem 1rem;
    }

    .list-group-item.active {
        background-color: #0066b2;
        color: white;
        border-color: #0066b2;
    }

    /* Menu Card Styles */
    .menu-card {
        border: none;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
    }

    .menu-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Item Image Container */
    .item-image-container {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .item-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Type Indicators */
    .type-indicator {
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 0 25px 25px 0;
        right: 0;
        top: 0;
    }

    .type-indicator.vegetarian {
        border-color: transparent #28a745 transparent transparent;
    }

    .type-indicator.non-vegetarian {
        border-color: transparent #dc3545 transparent transparent;
    }

    .type-indicator.vegan {
        border-color: transparent #FF9900 transparent transparent;
    }

    /* Order Summary Styles */
    .order-summary {
        border-left: 1px solid #e0e0e0;
        height: calc(100vh - 60px);
        overflow-y: auto;
    }

    .table-info {
        text-align: right;
        font-size: 0.9rem;
    }

    /* Badge Styles */
    .badge.rounded-circle {
        display: inline-block;
    }

    .order-summary {
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .item {
        border-bottom: 1px solid #f0f0f0;
        padding-bottom: 8px;
        margin-bottom: 8px;
    }

    .input-group .form-control {
        text-align: center;
    }

    .input-group-sm .btn {
        padding: 0.25rem 0.5rem;
    }

    .order-summary {
        border-left: 1px solid #e0e0e0;
        height: calc(100vh - 60px);
        overflow-y: auto;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .accordion-item {
        background-color: #fff;
        border-radius: 4px;
    }

    .accordion-header {
        cursor: pointer;
    }

    .accordion-body {
        background-color: #f9f9f9;
        border-radius: 0 0 4px 4px;
        display: none; /* Hidden by default */
    }

    .quantity-control {
        width: 85px;
    }

    .quantity-control .form-control {
        text-align: center;
        padding: 0.25rem;
    }

    .input-group-sm .btn {
        padding: 0.25rem 0.4rem;
        font-size: 0.875rem;
    }

    .order-items .accordion-item:last-child {
        margin-bottom: 0;
    }
    
</style>
<script>
    $(document).ready(function() {
        $('.accordion-header').click(function() {
            $(this).closest('.accordion-item').find('.accordion-body');
            $(this).find('i').toggleClass('fa-chevron-down fa-chevron-right');
        });
    });
</script>
<script src="~/js/ordermenu.js"></script>namespace PizzaShop.Entity.ViewModel;
public class OrderDetailsViewModel
{
    public int OrderId { get; set; }
    public string InvoiceNumber { get; set; }
    public string Status { get; set; }
    public string PaymentMode { get; set; }
    public DateTime PaidOn { get; set; }
    public DateTime PlacedOn { get; set; }
    public DateTime? ModifiedOn { get; set; }
    public TimeSpan OrderDuration { get; set; }
    public double TotalAmount { get; set; }
    public double SubTotal { get; set; }

    public string CustomerName { get; set; }
    public string Phone { get; set; }
    public string Email { get; set; }
    public int NumberOfPersons { get; set; }

    public string TableName { get; set; }
    public string SectionName { get; set; }

    public List<OrderItemViewModel> OrderItems { get; set; }

    public List<OrderTaxViewModel> Taxes { get; set; }
}

public class OrderItemViewModel
{
    public int SrNo { get; set; }
    public string ItemName { get; set; }
    public int Quantity { get; set; }
    public double Price { get; set; }
    public double TotalAmount { get; set; }
    public string Status { get; set; }
    public List<OrderItemModifierViewModel> Modifiers { get; set; }
}

public class OrderItemModifierViewModel
{
    public string ModifierName { get; set; }
    public int Quantity { get; set; }
    public double Price { get; set; }
    public double TotalAmount { get; set; }
}

public class OrderTaxViewModel
{
    public string TaxName { get; set; }
    public double TaxValue { get; set; }
}@model PizzaShop.Entity.ViewModel.OrderDetailsViewModel
@{
    Layout = "~/Views/Shared/_SecondLayout.cshtml";
    ViewData["Title"] = "OrderDetails";
}

<div class="row-11 d-flex align-items-center justify-content-center">
    <div class="row w-75">
        <div class="text-Users-title my-3 mx-2 fs-2 col-6">
            Order-Details
        </div>
        <div class="col my-3 text-align-right">
            <a asp-controller="Order" asp-action="Index">
                <button class="px-3 py-2 back-button">
                    Back
                </button>
            </a>
        </div>
        <div class=" col-12 my-3 bg-white table-shadow p-2">
            <div class="row-12 d-flex w-100 align-items-center">
                <p class=" col-3 fs-4 ">Order Summary</p>
                <p class="order-status fs-5 col-2">@Model.Status</p>
                <div class="col-7 d-flex justify-content-end p-2">
                    <button id="exportPdfBtn" data-order-id="@Model.OrderId" class="row px-3 p-2 send-button export-button">
                        <div class="d-flex">
                            <i class="fa-solid fa-file-export my-2"></i>
                            <p class="my-1">Export</p>
                        </div>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-2">
                    Invoice No :
                </div>
                <div class="col-1">
                    @Model.InvoiceNumber
                </div>
            </div>
            <div class="row w-100">
                <div class="col-2 w-auto">
                    Paid On:
                </div>
                <div class="col-1 w-auto">
                    @Model.PaidOn.ToString("yyyy-MM-dd HH:mm")
                </div>
                <div class="col-2 w-auto">
                    Placed On:
                </div>
                <div class="col-1 w-auto">
                    @Model.PlacedOn.ToString("yyyy-MM-dd HH:mm")
                </div>
                <div class="col-2 w-auto">
                    Modified On:
                </div>
                <div class="col-1 w-auto">
                    @(Model.ModifiedOn?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")
                </div>
                <div class="col-2 w-auto">
                    Order Duration:
                </div>
                <div class="col-1 w-auto">
                    @Model.OrderDuration.ToString(@"hh\:mm")
                </div>
            </div>
        </div>
        <div class="col-6 bg-white table-shadow">
            <div class="row d-flex">
                <i class="fa-regular fa-user col"></i>
                <p>
                    Customer-Details
                </p>
            </div>
            <div class="row">
                <p class="col">Name: @Model.CustomerName</p>
            </div>
            <div class="row">
                <p class="col">Phone: @Model.Phone</p>
            </div>
            <div class="row">
                <p class="col">No. Of Person: @Model.NumberOfPersons</p>
            </div>
            <div class="row">
                <p class="col">Email : @Model.Email</p>
            </div>
        </div>
        <div class="col-6 bg-white table-shadow">
            <div>
                <i class="fa-solid fa-chair"></i>
                <p>
                    Table Details
                </p>
            </div>
            <div class="row">
                <p class="col">Table: @Model.TableName</p>
            </div>
            <div class="row">
                <p class="col">Section: @Model.SectionName</p>
            </div>
        </div>
        <div class="col-12 my-2 bg-white table-shadow">
            <p>Order Items</p>
            <div class="table-responsive row m-2">
                <table class="table ">
                    <thead>
                        <tr>
                            <th scope="col" class="text-black-50">Sr.no</th>
                            <th scope="col" class="text-black-50">Item</th>
                            <th scope="col" class="text-black-50">Quantity</th>
                            <th scope="col" class="text-black-50">Price</th>
                            <th scope="col" class="text-black-50">Total Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderItems)
                        {
                            <tr>
                                <td>
                                    @item.SrNo
                                </td>
                                <td>
                                    @item.ItemName
                                    @if (item.Modifiers.Any())
                                    {
                                        <div>
                                            @foreach (var modifier in item.Modifiers)
                                            {
                                                <li>
                                                    @modifier.ModifierName
                                                </li>
                                            }
                                        </div>
                                    }
                                </td>
                                <td>
                                    @item.Quantity
                                    @if (item.Modifiers.Any())
                                    {
                                        <div>
                                            @foreach (var modifier in item.Modifiers)
                                            {
                                                <div>
                                                    @modifier.Quantity
                                                </div>
                                            }
                                        </div>
                                    }
                                </td>
                                <td>
                                    @item.Price.ToString("0.00")
                                    @if (item.Modifiers.Any())
                                    {
                                        <div>
                                            @foreach (var modifier in item.Modifiers)
                                            {
                                                <div>
                                                    @modifier.Price.ToString("0.00")
                                                </div>
                                            }
                                        </div>
                                    }
                                </td>
                                <td>
                                    @((item.Price * item.Quantity).ToString("0.00"))
                                    @if (item.Modifiers.Any())
                                    {
                                        <div>
                                            @foreach (var modifier in item.Modifiers)
                                            {
                                                <div>
                                                    @((modifier.Price * modifier.Quantity).ToString("0.00"))
                                                </div>
                                            }
                                        </div>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="justify-content-end w-100 col">
                <p class="text-align-right"> SubTotal:
                    @{
                        double subTotal = 0, total = 0;
                        @foreach (var item in Model.OrderItems)
                        {
                            subTotal += item.Price * item.Quantity;
                            @if (item.Modifiers.Any())
                            {
                                @foreach (var modifier in item.Modifiers)
                                {
                                    subTotal += modifier.Price * modifier.Quantity;
                                }
                            }
                        }
                        total += subTotal;
                    }
                    @("₹ " + subTotal.ToString("0.00"))</p>
                @foreach (var tax in Model.Taxes)
                {
                    <p class="text-align-right"> @tax.TaxName: @("₹ " + ((subTotal * tax.TaxValue * 0.01).ToString("0.00")))</p>
                    total += (subTotal * tax.TaxValue * 0.01);
                }
                <p class="text-align-right"> Total: @("₹ " + (total.ToString("0.00")))</p>
            </div>
        </div>
    </div>
</div>
